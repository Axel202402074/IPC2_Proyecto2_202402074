<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Invernaderos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Sistema de Riego </h1>
        <nav>
            <a href="/">Inicio</a>
            <a href="/ayuda">Ayuda</a>
        </nav>

        {% if not tiene_invernaderos %}
            <div class="section">
                <h2>Cargar XML</h2>
                <form action="/cargar" method="post" enctype="multipart/form-data">
                    <input type="file" name="archivo" accept=".xml" required>
                    <button type="submit">Cargar</button>
                </form>
            </div>
        {% else %}
            <div class="section">
                <h2>Invernaderos Disponibles</h2>
                <ul>
                {% for inv in invernaderos %}
                    <li>
                        <strong>{{ inv.nombre }}</strong> - 
                        {% set contador = namespace(value=0) %}
                        {% for plan in inv.planes %}
                            {% set contador.value = contador.value + 1 %}
                        {% endfor %}
                        {{ contador.value }} planes
                    </li>
                {% endfor %}
                </ul>
            </div>

            <div class="section">
                <h2>Simular Plan</h2>
                <form action="/simular" method="post">
                    <label>Seleccione Invernadero y Plan:</label>
                    <select name="invernadero_plan" required>
                        <option value="">Seleccione...</option>
                        {% for inv in invernaderos %}
                            <optgroup label="{{ inv.nombre }}">
                                {% for plan in inv.planes %}
                                    <option value="{{ inv.nombre }}|{{ plan.nombre }}">
                                        {{ plan.nombre }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endfor %}
                    </select>
                    <button type="submit">Simular</button>
                </form>
            </div>

            <div class="section">
                <h2>Graficar</h2>
                <form action="/graficar" method="post">
                    <label>Seleccione Invernadero y Plan:</label>
                    <select name="invernadero_plan" required>
                        <option value="">Seleccione...</option>
                        {% for inv in invernaderos %}
                            <optgroup label="{{ inv.nombre }}">
                                {% for plan in inv.planes %}
                                    <option value="{{ inv.nombre }}|{{ plan.nombre }}">
                                        {{ plan.nombre }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endfor %}
                    </select>
                    
                    <label>Tiempo:</label>
                    <input type="number" name="tiempo" value="5" min="1" required>
                    
                    <button type="submit">Generar Grafico</button>
                </form>
            </div>

            <div class="section">
                <h2>Reportes</h2>
                <div class="button-group">
                    <a href="/generar_html" class="button">Reporte HTML</a>
                    <a href="/generar_xml" class="button">Descargar XML</a>
                </div>
            </div>
        {% endif %}
    </div>
</body>
</html>