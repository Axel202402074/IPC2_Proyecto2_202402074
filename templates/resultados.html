<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .tabla-instrucciones {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .tabla-instrucciones th {
            background-color: #374c91;
            color: white;
            padding: 12px;
            text-align: center;
        }
        .tabla-instrucciones td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
            min-width: 150px;
        }
        .tabla-instrucciones tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .accion-regar {
            background-color: #e3f2fd;
            font-weight: bold;
        }
        .accion-adelante {
            background-color: #fff9c4;
        }
        .accion-esperar {
            background-color: #f5f5f5;
            color: #999;
        }
        .tiempo-col {
            background-color: #e8f5e9;
            font-weight: bold;
            width: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Resultados de Simulacion</h1>
        <nav>
            <a href="/">Volver</a>
            <a href="/ayuda">Ayuda</a>
        </nav>

        <div class="section">
            <h2>{{ invernadero_actual.nombre }} - {{ plan_actual.nombre }}</h2>
            
            <h3>Estadisticas</h3>
            <table>
                <tr>
                    <th>Tiempo Optimo</th>
                    <th>Agua Total</th>
                    <th>Fertilizante Total</th>
                </tr>
                <tr>
                    <td>{{ resultados.tiempo_optimo }} segundos</td>
                    <td>{{ resultados.agua_total }} litros</td>
                    <td>{{ resultados.fertilizante_total }} gramos</td>
                </tr>
            </table>

            <h3>Fertilizante por Dron</h3>
            <table>
                <tr>
                    <th>Dron</th>
                    <th>Agua Usada (L)</th>
                    <th>Fertilizante Usado (g)</th>
                </tr>
                {% for dron, consumo in resultados.consumo_por_dron.items() %}
                <tr>
                    <td><strong>{{ dron }}</strong></td>
                    <td>{{ consumo.agua }}</td>
                    <td>{{ consumo.fertilizante }}</td>
                </tr>
                {% endfor %}
            </table>

            <h3>Asignacion de Drones por Hilera</h3>
            <table>
                <tr>
                    <th>Hilera</th>
                    <th>Dron</th>
                </tr>
                {% for dron in invernadero_actual.drones %}
                <tr>
                    <td>Hilera {{ dron.hilera }}</td>
                    <td>{{ dron.nombre }}</td>
                </tr>
                {% endfor %}
            </table>

            <h3>Instrucciones por Tiempo y Dron</h3>
            <div style="overflow-x: auto;">
                <table class="tabla-instrucciones">
                    <thead>
                        <tr>
                            <th>Tiempo (s)</th>
                            {% for dron in invernadero_actual.drones %}
                            <th>{{ dron.nombre }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in range(1, resultados.tiempo_optimo + 1) %}
                        <tr>
                            <td class="tiempo-col">{{ t }}</td>
                            {% for dron in invernadero_actual.drones %}
                                {% set encontrado = namespace(value=False) %}
                                {% for instr in plan_actual.secuencia %}
                                    {% if instr.tiempo == t and instr.dron == dron.nombre and not encontrado.value %}
                                        {% set encontrado.value = True %}
                                        {% set accion_lower = instr.accion.lower() %}
                                        {% if 'regar' in accion_lower %}
                                <td class="accion-regar">
                                    Regar
                                    {% if instr.planta %}<br><small>{{ instr.planta }}</small>{% endif %}
                                </td>
                                        {% elif 'adelante' in accion_lower %}
                                <td class="accion-adelante">{{ instr.accion }}</td>
                                        {% elif 'atras' in accion_lower %}
                                <td class="accion-adelante">{{ instr.accion }}</td>
                                        {% elif 'esperar' in accion_lower %}
                                <td class="accion-esperar">Esperar</td>
                                        {% else %}
                                <td>{{ instr.accion }}</td>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                {% if not encontrado.value %}
                                <td class="accion-esperar">-</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

<!--            <h3>Lista Detallada de Instrucciones</h3>
            <table>
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Tiempo (s)</th>
                        <th>Dron</th>
                        <th>Accion</th>
                    </tr>
                </thead>
                <tbody>
                    {% set contador = namespace(value=0) %}
                    {% for instr in plan_actual.secuencia %}
                    {% set contador.value = contador.value + 1 %}
                    <tr>
                        <td>{{ contador.value }}</td>
                        <td>{{ instr.tiempo }}</td>
                        <td>{{ instr.dron }}</td>
                        <td>
                            {% if instr.planta %}
                                {{ instr.accion }} ({{ instr.planta }})
                            {% else %}
                                {{ instr.accion }}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>-->
        </div>
    </div>
</body>
</html>